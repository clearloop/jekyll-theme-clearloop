# CAP 定理权衡

这不是关于CAP定理的讨论，而是关于GUN决定默认的权衡。马克在柏林对此进行了很好的谈话，这些解释清楚易懂。Jepsen测试（启发了我们的分布式测试框架）的凯尔金斯伯里（Aphyr）在那里，他在我们的推文上发表了看法。别忘了查看我们关于P2P加密技术的安全系列。

#### AP 
默认情况下，GUN是一个AP系统，这意味着即使其他对等设备处于脱机状态，GUN也可以成功读取和写入数据。因此，GUN在线性化方面并不是很一致。相反，它最终是一致的，以便为用户提供高度可用性而不管连接性如何。当连接性再次变得可用时，GUN将使用至少一次传送以低延迟同步数据，以确保所有对等体在一段时间内确定性地收敛到同一数据，而无需任何额外的协调或闲聊。

#### 最终一致性
如上所述，GUN选择最终的一致性。这意味着，如果世界两边的人在“同一时间”修改同一条数据，他们就不会知道彼此的冲突更新，直到信息通过慢速网络传播给他们。意味着他们的更新不会解析为“一致”的视图，直到经过一段时间。为什么会这样？因为物理学不能打破光速，所以在所有已知的科学中，瞬间交流是不可能的。

#### 强一致性
那么强大的一致性有多可能呢？它建立在最终一致的消息传递系统的顶部。这些消息向所有对等点广播一个“锁定”请求，以便修改数据（这个例子忽略了潜在的锁定请求冲突）。对等方“回复”接受数据锁定，这意味着他们不会允许本地用户读取或写入该数据，从而导致用户的高延迟。一旦原始同行得到了一致的批准，它就会写入数据并等待它从对等方获得成功。从以下两点可以看出：

+ 该系统不具备高可用性，如果存在网络分区（也就是说，如果无法访问任何一个对等设备），则无需等待无限期的时间，就不能说数据是一致的。
+ 强一致性是最终一致的消息传递系统的一个新兴属性。含义GUN可能在高度可用的情况下演变成CP系统。

#### 线性化
虽然最后一点很有趣，但不建议将GUN演变为锁定系统。相反，在收敛复制数据类型（CRDT），有向无环图（DAG），操作转换（OT或WOOT）和一些分块链分类账的新研究提供了类似的保证，而不模拟任何集中式机制。这些系统在数据中明确声明了“依赖因果关系”，而不是协议 - 因此应该是首选，因为它们在不牺牲对等系统的优点的情况下为您提供某种形式的线性化。看到这篇文章更多细节。

### 摘要
GUN是默认情况下AP的最终一致性，但可以升级到CP系统，但不推荐使用。相反，应该在应用程序层手动应用某种形式的“依赖因果关系”到数据本身，或者作为一个模块为您打包。
